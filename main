#provenienza dataset  Food and Agricultural Organization of United Nations
#https://data.worldbank.org/indicator/NY.GDP.MKTP.CD
import pandas as pd
import numpy as np
crop = pd.read_csv("crop1.csv")
live = pd.read_csv("live1.csv")
pop = pd.read_csv("pop1.csv")
gdp = pd.read_csv("gdp.csv")

#modifica il dataset gdp per avere sulle righe il gdp di un anno
gdp.drop(["Unnamed: 66","Indicator Code","Indicator Name"],axis=1,inplace=True)
gdp = gdp.melt(id_vars=["Country Name","Country Code"],var_name="Year",value_name="GDP")
gdp = gdp.astype({"Year" : "int64"})

#modifica il dataset gdp per avere 'aumento percentuale della produzione/raccolto/semina rispetto all'anno precedente per ogni paese
crop["Previous_value"] = 0
crop["Previous_value"].iloc[1:] = crop["Value"].iloc[:-1]
crop.loc[crop[["Area","Item","Element"]].drop_duplicates().index,"Previous_value"] = 0
crop["Increase"] = 100*(crop["Value"]-crop["Previous_value"])/crop["Previous_value"]
crop.replace([np.inf, -np.inf, np.nan], 0, inplace=True)

#unisci il gdp per ogni paese per ogni anno
crop = crop.merge(gdp,how="left",left_on=["Area","Year"],right_on=["Country Name","Year"])
crop.drop("Country Name",axis=1,inplace=True)

crop

